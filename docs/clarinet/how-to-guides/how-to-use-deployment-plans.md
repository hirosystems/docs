# Deployment plans

Deployment Plans are reproducible deployment steps that publish a collection of on-chain transactions and one or more contracts to a network, whether a local developer network, the public testwork, or into production on mainnet. Deployment plans minimize the inherent complexity of deployments, such as smart contract dependencies and interactions, transaction chaining limits, deployment costs, and more, while also ensuring reproducible deployments which are critical for testing purposes.

<center>
<img src="../images/deployment-plan-blocks.png" alt="dpb" width="400"/ >
</center>


Furthermore, many details of the blockchain environment you want to deploy to are configurable in a deployment plan's specifications.

| Network | Features | Limitations |
| ------- | -------- | ----------- |
| `simnet` | - Widely configurable Stacks simnet <br> - No private keys needed (for contacts, transactions) <br> - Stored entirely in memory | - No Bitcoin emulation |
| `devnet` | - Widely configurable Stacks and Bitcoin devnets <br> - Publish contracts, transactions across multiple Stacks and/or Bitcoin blocks <br> - Control chainstate for tests | - Accounts need private keys (see `devnet.toml`) |
| `testnet`/`mainnet` | - Public networks with other users and contracts <br> | - Time-consuming and expensive environment for testing |

## Viewing your deployment plan

Clarinet uses a deployment plan for every deployment-whether for a basic simnet (for use in Clarinet's `console`, `test`, and `check` features), a devnet (for use with Clarinet's `integrate` command), or the public testnet and mainnet.

You can view the current deployment plan saved to disk at any time with the following command (specifying the network `simnet`, `devnet`, `testnet`, `mainnet`)

```bash
clarinet deployments generate --<network>
```

Upon this command, your project's deployment plan, a `.yaml` file (e.g. `default.devnet-plan.yaml`), is generated by default from your project specifications and contracts. Here, for example, is the deployment plan for [this `counter` smart contract application](https://github.com/hirosystems/clarinet/blob/develop/components/clarinet-cli/examples/counter/deployments/default.devnet-plan.yaml):

```toml
---
id: 0
name: Devnet deployment
network: devnet
stacks-node: "http://localhost:20443"
bitcoin-node: "http://devnet:devnet@localhost:18443"
plan:
  batches:
    - id: 0
      transactions:
        - contract-publish:
            contract-name: counter
            expected-sender: ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
            cost: 5960
            path: contracts/counter.clar
            anchor-block-only: true
            clarity-version: 1
```

## Specifications files 

A project's deployment plan specifications are set on two files within a Clarinet project—the `clarinet.toml` file as well as the network’s corresponding `.toml` file (e.g. `devnet.toml`) in the `/settings` folder. 

Specifications in the `clarinet.toml` file you can change include
- The Clarity version or blockchain epoch Clarinet will emulate for your smart contracts
- Contract dependencies you would like to simulate

Specifications in the `devnet.toml` file you can change include
- Accounts, balances, and names
- Blockchain environment features, such as block time or API ports, of your devnet
- [Stacking](https://docs.stacks.co/docs/understand-stacks/stacking) orders

Furthermore, each deployment plan will list your contracts and any public functions.

## Editing your deployment plan directly

Recall, a default deployment plan, comprising your projects specifications as set in your `clarinet.toml` and `devnet.toml` files, is used for every deployment and is generated upon each `clarinet deployments generate --<network>` shell command to your `/deployments` folder.

However, you can also manually edit this default deployment `.yaml` file directly—programmatically orchestrating your contract publication and interaction—with these `transaction` types available: 

:::note
If you manually edit the generated deployment plan under `/deployments`, you will be prompted to overwrite the default deployment generated by your Clarinet project's `.toml` files—type `yes` to overwrite with your new deployment plan.
:::

- `emulated-contract-publish`: Deploy a contract in an in-memory simulated chain (`simnet` only).
- `emulated-contract-call`: Call a contract that has been deployed in an in-memory simulated chain (simnet only).
- `requirement-publish`: Deploy an external contract (i.e., not published by the same set of private keys as the user wallet currently deploying) on another `testnet`/`devnet` using another wallet + search, and replace all the references to this contract in the local contracts to deploy (`devnet`/`testnet` only).
- `contract-publish`: Deploy a contract (`devnet`/`testnet`/`mainnet`).
- `contract-call`: Call a contract (`devnet`/`testnet`/`mainnet`).
- `btc-transfer`: Simple bitcoin transfer from a p2pkh address to a p2pkh address (experimental, `regtest`/`testnet`/`mainnet`).


### `emulated-contract-publish`

This is a default transaction that is included in every generated deployment for a `simnet` deployment. The institutional lending protocol [Zest has a code audit](https://github.com/Trust-Machines/Zest-Audit/blob/1c35ea49fff7d990aa58d045f1e3bcac5e65406c/deployments/default.simnet-plan.yaml) that includes a simnet environment

```toml
transactions:
    - emulated-contract-publish:
        contract-name: extension-trait
        emulated-sender: ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
        path: contracts/dao/traits/extension-trait.clar
        clarity-version: 1
```

### `emulated-contract-call`

### `requirement-publish`

This cBTC smart contract application has a [devnet deployment plan](https://github.com/hirosystems/clarinet/blob/develop/components/clarinet-cli/examples/cbtc/deployments/default.devnet-plan.yaml) that publishes the contract required by its core smart contract.

```toml
transactions:
    - requirement-publish:
        contract-id: SP3FBR2AGK5H9QBDH3EEN6DF8EK8JY7RX8QJ5SVTE.sip-010-trait-ft-standard
        remap-sender: ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
        remap-principals:
            SP3FBR2AGK5H9QBDH3EEN6DF8EK8JY7RX8QJ5SVTE: ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
        cost: 8400
        path: ".cache/requirements/SP3FBR2AGK5H9QBDH3EEN6DF8EK8JY7RX8QJ5SVTE.sip-010-trait-ft-standard.clar"
```

### `contract-publish`

This is a default transaction that is included in every generated deployment plan for every contract your Clarinet project has. This "counter" application has a [devnet deployment plan](https://github.com/hirosystems/clarinet/blob/develop/components/clarinet-cli/examples/counter/deployments/default.devnet-plan.yaml) that publishes its core smart contract.

```toml
transactions:
    - contract-publish:
        contract-name: counter
        expected-sender: ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
        cost: 5960
        path: contracts/counter.clar
        anchor-block-only: true
        clarity-version: 1
```

### `contract-call`

This "counter" application has a [devnet deployment plan](https://github.com/hirosystems/clarinet/blob/develop/components/clarinet-cli/examples/counter/deployments/increment.devnet-plan.yaml) that performs a contract call, passing an argument to the `increment` method.

```toml
transactions:
    - contract-call:
        contract-id: ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.counter
        expected-sender: ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
        method: increment
        parameters:
            - u1
        cost: 5960
```

### `btc-transfer`

This cBTC smart contract application has a [devnet deployment plan](https://github.com/hirosystems/clarinet/blob/develop/components/clarinet-cli/examples/cbtc/deployments/wrap-btc.devnet-plan.yaml) that includes broadcasting a BTC transfer transaction to the emulated bitcoin chain with these parameters (in order to trigger the cBTC protocol's "wrap" functionality).

```toml
transactions:
    - btc-transfer:
        expected-sender: mjSrB3wS4xab3kYqFktwBzfTdPg367ZJ2d
        recipient: bcrt1qnxknq3wqtphv7sfwy07m7e4sr6ut9yt6ed99jg
        sats-amount: 100000000
        sats-per-byte: 10
```