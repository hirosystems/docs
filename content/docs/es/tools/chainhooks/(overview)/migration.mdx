---
title: Guía de migración
description: Guía para migrar chainhooks heredados a v2
---
:::callout
### Gestión de chainhooks v1

Los chainhooks legacy v1 permanecen de solo lectura en la interfaz de usuario de la plataforma, pero puedes gestionarlos a través del [API de Plataforma](/apis/platform-api/reference/chainhooks/list).
:::

## Qué aprenderás

:::objectives
* Capturar y analizar todos los chainhooks v1 existentes.
* Convertir filtros basados en predicados en definiciones de eventos v2 explícitas.
* Registrar chainhooks v2, probar la entrega y retirar los originales de forma segura.
:::

## Requisitos previos

:::prerequisites
* Clave API de Hiro para acceso tanto a la Plataforma como a la API de Chainhooks.
:::

<Steps>
  <Step>
    ### Obtener una lista de chainhooks v1

    Usa la API de la Plataforma para obtener los chainhooks que quieres migrar.

    ```ts index.ts -c
    const response = await fetch(`https://api.platform.hiro.so/v1/ext/${process.env.HIRO_API_KEY}/chainhooks`, {
      headers: {
        'content-type': 'application/json'
      }
    });

    const chainhooks = await response.json();
    ```
  </Step>

  <Step>
    ### Comenzar a mapear al nuevo formato v2

    Traduce las estructuras v1 a formatos v2 antes de crear nuevos hooks. La siguiente tabla muestra el mapeo entre las estructuras v1 y v2:

    | v1 | v2 | Notes |
    |------------|-----------|-------|
    | `if_this.scope` I don't see any text to translate in your message. You've provided detailed translation rules but no actual content to translate from English to Spanish. Please provide the text you'd like me to translate. `filters.events[].type` | Reemplazar `scope/action` combos con un solo tipo de evento. |
    | `if_this.actions` | `type` I notice that you've provided the translation rules and instructions, but the actual text to translate appears to be just a single vertical bar "|" character.&#x20;

    Since this is just a formatting character and not text content, the translation would be:

    | `transfer` se asigna a `*_transfer`. |
    | `then_that.http_post.url` | `action.url` | v2 maneja secretos automáticamente. |
    | `networks.mainnet` | `network: "mainnet"` | Crea un hook v2 por red. |
    | `authorization_header` | Gestión de secretos de webhook | Usar `rotateConsumerSecret()` después del registro. |

    #### Ejemplo

    <CodeTabs flags="ac">
      ```json !! Legacy
      {
        "name": "stx-transfers",
        "networks": {
          "mainnet": {
            "if_this": { "scope": "stx_event", "actions": ["transfer"] },
            "then_that": { "http_post": { "url": "https://example.com/webhooks" } }
          }
        }
      }
      ```

      ```json !! v2
      {
        "version": "1",
        "name": "stx-transfers",
        "chain": "stacks",
        "network": "mainnet",
        "filters": {
          "events": [{ "type": "stx_transfer" }]
        },
        "action": {
          "type": "http_post",
          "url": "https://example.com/webhooks"
        },
        "options": {
          "decode_clarity_values": true,
          "enable_on_registration": true
        }
      }
      ```
    </CodeTabs>

    Para más detalles sobre los cambios de formato, consulta el [Filtros](/tools/chainhooks/reference/filters) guía de referencia.
  </Step>

  <Step>
    ### Crear chainhooks v2

    Register each chainhook with the SDK or REST API, mirroring the mapped filters.

    <CodeTabs flags="ac">
      ```ts !! api.ts
      const v2Chainhook = {
        "version": "1",
        "name": "stx-transfers",
        "chain": "stacks",
        "network": "mainnet",
        "filters": {
          "events": [{ "type": "stx_transfer" }]
        },
        "action": {
          "type": "http_post",
          "url": "https://example.com/webhooks"
        },
        "options": {
          "decode_clarity_values": true,
          "enable_on_registration": true
        }
      });

      const response = await fetch('https://api.hiro.so/chainhooks/v1/me/', {
        method: 'POST',
        headers: {
          'x-api-key': process.env.HIRO_API_KEY!,
          'content-type': 'application/json',
        },
        body: JSON.stringify(v2Chainhook),
      });
      ```

      ```ts !! sdk.ts
      const client = new ChainhooksClient({
        baseUrl: CHAINHOOKS_BASE_URL.mainnet,
        apiKey: process.env.HIRO_API_KEY!,
      });
      const chainhook = await client.registerChainhook(
        {
          "version": "1",
          "name": "stx-transfers",
          "chain": "stacks",
          "network": "mainnet",
          "filters": {
            "events": [{ "type": "stx_transfer" }]
          },
          "action": {
            "type": "http_post",
            "url": "https://example.com/webhooks"
          },
          "options": {
            "decode_clarity_values": true,
            "enable_on_registration": true
          }
        }
      );
      ```
    </CodeTabs>
  </Step>

  <Step>
    ### Validar y limpiar chainhooks heredados

    Transmite eventos a través de ambas versiones, confirma la entrega, luego limpia las definiciones heredadas.

    :::callout
    type: info

    ### Mejores prácticas

    Mantén tanto los hooks v1 como v2 activos hasta que verifiques la paridad de entrega.
    :::

    #### Verificaciones de habilitación en v2

    <CodeTabs flags="ac">
      ```ts !! api.ts
      const response = await fetch(`https://api.hiro.so/chainhooks/v1/me/${uuid}`, {
        method: 'GET',
        headers: {
          'x-api-key': process.env.HIRO_API_KEY!,
          'content-type': 'application/json',
        },
      });

      const chainhook = await response.json();
      console.log(chainhook.status.enabled);
      ```

      ```ts !! sdk.ts
      const chainhook = await client.getChainhook(uuid);
      console.log(chainhook.status.enabled);
      ```
    </CodeTabs>

    #### Eliminar chainhooks heredados

    ```ts -c
    const response = await fetch(
      `https://api.platform.hiro.so/v1/ext/${process.env.HIRO_API_KEY}/chainhooks/${uuid}`,{
        method: 'DELETE',
        headers: {
          'content-type': 'application/json'
        }
      }
    );

    await response.json();
    ```
  </Step>
</Steps>

## Referencia de filtro

### Ámbitos comunes

| v1 | Acciones Típicas | v2 | Extras |
|----------|-----------------|-----------|--------|
| `stx_event` I notice that you've provided the translation rules but the actual text to translate appears to be just a single vertical bar "|".&#x20;

| `transfer` | `stx_transfer` | Incluir `sender` o `recipient` filtros según sea necesario. |
| `contract_call` | n/a | `contract_call` | Agregar `contract_identifier` y `function_name`. |
| `ft_event` | `transfer` I don't see any text provided to translate. Could you please share the text you'd like me to translate from English to Spanish? `ft_transfer` | Especificar `asset_identifier`. |
| `nft_event` I notice that you've provided the translation rules but the actual text to translate appears to be just a single vertical bar "|".&#x20;

| `transfer`, `mint` I notice that you've provided the translation rules but the actual text to translate appears to be just a single vertical bar "|".&#x20;

| `nft_transfer` · `nft_mint` | Proporcionar `asset_identifier`. |

Para más detalles, consulta el [Filtros](/tools/chainhooks/reference/filters) página de referencia.

## Próximos pasos

:::next-steps
* [FAQ](/tools/chainhooks/faq): FAQ de Chainhooks 2.0 (Beta)
* [Referencia de Filtros](/tools/chainhooks/reference/filters): Referencia de Filtros
:::
