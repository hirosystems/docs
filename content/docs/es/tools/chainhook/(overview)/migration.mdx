---
title: Migración de v1 a v2
description: Guía para migrar chainhooks v1 heredados a Chainhook 2.0 Beta
---
:::callout
### Gestión de chainhooks v1

Los chainhooks v1 heredados permanecen de solo lectura en la interfaz de usuario de la plataforma; los gestionas a través del [API de Plataforma](/apis/platform-api/reference/chainhooks/list).
:::

## Lo que aprenderás

:::objectives
* Captura y analiza todos los chainhooks v1 existentes.
* Convierte filtros basados en predicados en definiciones explícitas de eventos v2.
* Registra chainhooks v2, prueba la entrega y retira los originales de forma segura.
:::

## Requisitos previos

:::prerequisites
* API access to both the Platform API and Chainhook REST API (same `HIRO_API_KEY`).
* SDK Local (`@hirosystems/chainhooks-client`) o `curl` for REST calls.
* Variable de entorno `HIRO_API_KEY` establecido para la CLI y ejemplos de código.
:::

<Steps>
  <Step>
    ### Inventario v1 chainhooks

    Utiliza la API de la Plataforma para obtener cada chainhook que aún se ejecuta en producción.

    #### CLI

    ```bash
    curl -sS "https://api.platform.hiro.so/v1/ext/$HIRO_API_KEY/chainhooks" \
      -H "content-type: application/json"
    ```

    #### TypeScript

    ```typescript
    export async function listV1Chainhooks() {
      const response = await fetch(
        `https://api.platform.hiro.so/v1/ext/${process.env.HIRO_API_KEY}/chainhooks`,
        { headers: { 'content-type': 'application/json' } }
      );

      if (!response.ok) throw new Error(response.statusText);
      return (await response.json()) as any[];
    }

    const chainhooks = await listV1Chainhooks();
    console.log(`Found ${chainhooks.length} v1 chainhooks`);
    ```
  </Step>

  <Step>
    ### Inspeccionar un chainhook

    Pull the full definition for each UUID so you can convert custom filters and metadata.

    #### CLI

    ```bash
    curl -sS \
      "https://api.platform.hiro.so/v1/ext/$HIRO_API_KEY/chainhooks/$CHAINHOOK_UUID" \
      -H "content-type: application/json"
    ```

    #### TypeScript

    ```typescript
    export async function getV1Chainhook(uuid: string) {
      const response = await fetch(
        `https://api.platform.hiro.so/v1/ext/${process.env.HIRO_API_KEY}/chainhooks/${uuid}`,
        { headers: { 'content-type': 'application/json' } }
      );

      if (!response.ok) throw new Error(response.statusText);
      return await response.json();
    }
    ```
  </Step>

  <Step>
    ### Configuración de mapeo a v2

    Traduce estructuras v1 a campos v2 antes de aprovisionar nuevos hooks.

    | v1 Concept | v2 Target | Notes |
    |------------|-----------|-------|
    | `if_this.scope` | `filters.events[].type` | Reemplazar `scope/action` combos con un solo tipo de evento. |
    | `if_this.actions` | `type` | `transfer` se mapea a `*_transfer`. |
    | `then_that.http_post.url` | `action.url` | v2 maneja los secretos automáticamente. |
    | `networks.mainnet` | `network: "mainnet"` | Crea un hook v2 por red. |
    | `authorization_header` | Gestión de secretos de webhook | Usar `rotateConsumerSecret()` después del registro. |

    #### Conversión de Ejemplo

    ```jsonc
    // v1 (Platform API)
    {
      "name": "stx-transfers",
      "networks": {
        "mainnet": {
          "if_this": { "scope": "stx_event", "actions": ["transfer"] },
          "then_that": { "http_post": { "url": "https://example.com/webhooks" } }
        }
      }
    }
    ```

    ```typescript
    // v2 (SDK)
    import { ChainhooksClient, CHAINHOOKS_BASE_URL } from '@hirosystems/chainhooks-client';

    const client = new ChainhooksClient({
      baseUrl: CHAINHOOKS_BASE_URL.mainnet,
      apiKey: process.env.HIRO_API_KEY!,
    });

    await client.registerChainhook({
      version: '1',
      name: 'stx-transfers',
      chain: 'stacks',
      network: 'mainnet',
      filters: {
        events: [{ type: 'stx_transfer' }],
      },
      action: {
        type: 'http_post',
        url: 'https://example.com/webhooks',
      },
      options: {
        decode_clarity_values: true,
        enable_on_registration: true,
      },
    });
    ```
  </Step>

  <Step>
    ### Crear chainhooks v2

    Provision each chainhook with the SDK or REST API, mirroring the mapped filters.

    #### REST

    ```bash
    curl -sS -X POST "https://api.mainnet.hiro.so/chainhooks/v1/me/" \
      -H "content-type: application/json" \
      -H "x-api-key: $HIRO_API_KEY" \
      -d @v2-chainhook.json
    ```

    #### SDK de Chainhook

    ```typescript
    const client = new ChainhooksClient({
      baseUrl: CHAINHOOKS_BASE_URL[config.network],
      apiKey: process.env.HIRO_API_KEY!,
    });
    const chainhook = await client.registerChainhook(config);
    ```
  </Step>

  <Step>
    ### Validar y retirar v1

    Transmite eventos a través de ambas versiones, confirma la entrega, luego limpia las definiciones heredadas.

    :::callout
    type: info

    ### Mejores prácticas

    Mantén tanto los hooks v1 como v2 activos hasta que verifiques la paridad de entrega.
    :::

    #### Verificaciones de Habilitación

    ```typescript
    const chainhook = await client.getChainhook(v2Uuid);
    console.log(chainhook.status.enabled);
    ```

    #### Eliminar con cURL

    ```bash
    curl -sS -X DELETE \
      "https://api.platform.hiro.so/v1/ext/$HIRO_API_KEY/chainhooks/$CHAINHOOK_UUID" \
      -H "content-type: application/json"
    ```

    #### Eliminar con SDK

    ```typescript
    export async function deleteV1Chainhook(uuid: string) {
      const response = await fetch(
        `https://api.platform.hiro.so/v1/ext/${process.env.HIRO_API_KEY}/chainhooks/${uuid}`,
        { method: 'DELETE', headers: { 'content-type': 'application/json' } }
      );

      if (!response.ok) throw new Error(response.statusText);
      return await response.json();
    }
    ```
  </Step>
</Steps>

## Referencia de Traducción de Filtros

### Ámbitos comunes

| v1 | Acciones Típicas | v2 | Extras |
|----------|-----------------|-----------|--------|
| `stx_event` I notice that you've provided the translation rules and instructions, but the actual text to translate appears to be just a single vertical bar "|".&#x20;

| `transfer` | `stx_transfer` | Incluir `sender` o `recipient` filtros según sea necesario. |
| `contract_call` | n/a | `contract_call` | Agregar `contract_identifier` y `function_name`. |
| `ft_event` | `transfer` | `ft_transfer` | Especificar `asset_identifier`. |
| `nft_event` | `transfer`, `mint` I don't see any text to translate in your message. You've provided the rules and formatting instructions, but the actual text content appears to be missing after "Text to translate:" - there's only a vertical bar "|" shown.

Could you please provide the actual text you'd like me to translate from English to Spanish? `nft_transfer` · `nft_mint` | Proporcionar `asset_identifier`. |

### Ejemplo

```jsonc
// v1 filter
{
  "scope": "stx_event",
  "actions": ["transfer"]
}
```

```jsonc
// v2 filter
{
  "events": [
    {
      "type": "stx_transfer",
      "recipient": "SP3FBR2AGKQX0..."
    }
  ]
}
```

:::next-steps
* [Documentación del SDK](/tools/chainhook/chainhook-sdk): Documentación del SDK
* [Referencia de Filtros](/tools/chainhook/reference/filters): Referencia de Filtros
:::
