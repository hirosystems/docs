---
title: Usar el archivo de la API de Blockchain de Stacks
description: Descubre cómo usar el Hiro Archive para poner en marcha una API de Stacks Blockchain.
---
## Prerrequisitos

Dado que la API de Stacks Blockchain depende de que un nodo de blockchain de Stacks esté en la misma altura de bloque, primero necesitarás [restaurar un nodo de blockchain de Stacks usando el Archivo de Hiro](/resources/archive/stacks-blockchain) antes de restaurar la API de Stacks Blockchain. De lo contrario, puedes encontrar errores al ejecutar la API.

Para que la blockchain de Stacks y los archivos de la API de la Blockchain de Stacks sean compatibles, deben cumplir con los siguientes criterios:

* Ambos archivos corresponden a la misma red de Stacks (mainnet/testnet).
* La versión del archivo API debe ser compatible con la versión del archivo de la blockchain Stacks (Ver [Notas de versión de API](https://github.com/hirosystems/stacks-blockchain-api/releases) para orientación).
* Ambos archivos fueron creados en la misma fecha.

## Métodos de restauración

Hay dos maneras de restaurar una API de Blockchain de Stacks usando el Archivo Hiro. El archivo de archivo que necesitarás descargar dependerá de tu método de restauración. No hay ningún escenario donde necesitarías ambos métodos de restauración.

**Restaurar mediante volcado de base de datos Postgres (Recomendado)**

Este es el método más rápido y directo, y es adecuado para la mayoría de escenarios. Consiste en una copia de seguridad de la base de datos Postgres de la API tomada usando `pg_dump`. Generalmente recomendamos comenzar con este método antes de intentar el método a continuación si este no funciona por alguna razón.

:::callout
type: info

### Esquema de Postgres

Necesitarás configurar la API `PG_SCHEMA` variable de entorno a: `PG_SCHEMA=stacks_blockchain_api` al restaurar desde un archivo.
:::

**Restaurar mediante archivo de valores separados por tabulaciones (TSV)**

Este método es varias veces más lento que restaurar desde un volcado de Postgres. El archivo TSV de la API contiene los eventos sin procesar en bruto de un nodo de blockchain de Stacks. La API puede ingerir este archivo para procesar eventos en una base de datos Postgres.
Restaurar desde un archivo TSV puede ser útil cuando un archivo de base de datos Postgres para una versión particular de API no está disponible o cuando no se puede usar por alguna razón.

## Dónde descargar archivos

Dependiendo del método de restauración utilizado anteriormente, los archivos de la API de Stacks Blockchain para cada red se pueden encontrar en las siguientes ubicaciones:

* Volcado de base de datos Postgres
  * mainnet: https://archive.hiro.so/mainnet/stacks-blockchain-api-pg/
  * testnet: https://archive.hiro.so/testnet/stacks-blockchain-api-pg/
* archivo TSV
  * mainnet: https://archive.hiro.so/mainnet/stacks-blockchain-api/
  * testnet: https://archive.hiro.so/testnet/stacks-blockchain-api/

Los patrones de nombres de archivo son los siguientes:

* Volcado de base de datos Postgres
  * archivo: `stacks-blockchain-api-pg-<DATABASE VERSION>-<API VERSION>-<DATE(YYYYMMDD)>.dump`
  * shasum: `stacks-blockchain-api-pg-<DATABASE VERSION>-<API VERSION>-<DATE(YYYYMMDD)>.sha256`
* archivo TSV
  * archivo: `<network>-stacks-blockchain-api-<API VERSION>-<DATE(YYYYMMDD)>.gz`
  * shasum: `<network>-stacks-blockchain-api-<API VERSION>-<DATE(YYYYMMDD)>.sha256`

Hay un archivo continuamente actualizado y shasum que siempre apunta a la carga más reciente:

* Volcado de base de datos Postgres
  * archivo: `stacks-blockchain-api-pg-<DATABASE VERSION>-latest.dump`
  * shasum: `stacks-blockchain-api-pg-<DATABASE VERSION>-latest.sha256`
* archivo TSV
  * archivo: `<network>-stacks-blockchain-api-latest.gz`
  * shasum: `<network>-stacks-blockchain-api-latest.sha256`

o la carga más reciente para una versión particular:

* Volcado de base de datos Postgres
  * archivo: `stacks-blockchain-api-pg-<DATABASE VERSION>-<API VERSION>-latest.dump`
  * shasum: `stacks-blockchain-api-pg-<DATABASE VERSION>-<API VERSION>-latest.sha256`
* archivo TSV
  * archivo: `<network>-stacks-blockchain-api-<API VERSION>-latest.gz`
  * shasum: `<network>-stacks-blockchain-api-<API VERSION>-latest.sha256`

## Restaurando la API de Blockchain de Stacks usando el Archivo de Hiro

**Si se restaura mediante volcado de Postgres**

1. Descarga el archivo y shasum para la red apropiada y método de restauración.
2. Verifica el archivo usando los pasos en el [guía de descarga](/resources/archive/download-guide#verification-and-extraction) (note: API archives may not have SHA256 files available).
3. Importa el archivo de archivo en una base de datos Postgres en ejecución (puede tomar hasta una hora dependiendo de las especificaciones y configuración de la base de datos):
   ```terminal
   $ export PGPASSWORD=<YOUR POSTGRES PASSWORD>
   $ pg_restore --username postgres --verbose --jobs 4 --dbname stacks_blockchain_api /path/to/archive/file
   ```
4. Lanza el servicio de API de Blockchain de Stacks.
5. Verificar que el conjunto de datos esté siendo utilizado comparando sus nodos [altura del bloque local](http://localhost:3999/extended/v1/status) con [Hiro's](https://api.hiro.so/extended/v1/status). Si la altura del bloque coincide o está cerca de la altura del bloque de Hiro, la restauración fue exitosa.
   1. Puede tomar unos minutos para que el nodo local responda en este endpoint.
   2. La altura de tu bloque puede estar hasta unos cientos de bloques de distancia del de Hiro dependiendo de la antigüedad del archivo. Debería ponerse al día relativamente rápido.

**Si se restaura mediante archivo TSV**

1. Descarga el archivo y el shasum para la red apropiada y el método de restauración.
2. Verificar el archivo usando los pasos en el [guía de descarga](/resources/archive/download-guide#verification-and-extraction) (note: API archives may not have SHA256 files available).
3. Extrae el archivo en el directorio deseado:
   ```terminal
   $ gzip -d <ARCHIVE FILE> --stdout > /path/to/extracted/file
   ```
4. [Sigue estas instrucciones](https://github.com/hirosystems/stacks-blockchain-api#export-and-import) procesar e importar los eventos del archivo TSV en tu base de datos Postgres.
5. Lanzar el servicio de API de Stacks Blockchain.
6. Verifica que el conjunto de datos esté siendo utilizado comparando tus nodos [altura del bloque local](http://localhost:3999/extended/v1/status) con [Hiro's](https://api.hiro.so/extended/v1/status). Si la altura del bloque coincide o está cerca de la altura del bloque de Hiro, la restauración fue exitosa.
   1. Puede tomar unos minutos para que el nodo local responda en este endpoint.
   2. La altura de tu bloque puede estar hasta unos cientos de bloques por detrás de la de Hiro dependiendo de la antigüedad del archivo. Debería ponerse al día relativamente rápido.
